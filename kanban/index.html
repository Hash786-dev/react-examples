<!DOCTYPE html>
<html>
  <head>
    <!-- React -->
    <script src="http://fb.me/react-0.12.2.js"></script>
    <script src="http://fb.me/JSXTransformer-0.12.2.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <!-- react-dnd -->
    <script src="ReactDND.min.js"></script>
    <!-- Custom -->
    <link rel="stylesheet" href="style.css" />
    <title>Kanban</title>
  </head>
  <body>
    <script type="text/jsx">
     var Task = React.createClass({
       render: function() {
         return (
           <li className="task">
             {this.props.text}
             <span className="delete"
                   onClick={this.props.deleteTask} />
           </li>
         );
       }
     });

     var AddTask = React.createClass({
       getInitialState: function() {
         return { text: "" };
       },

       handleChange: function(event) {
         this.setState({text: event.target.value});
       },

       render: function() {
         return (
           <div className="add-task">
             <input type="text"
                    value={this.state.text}
                    onChange={this.handleChange} />
             <button type="button" onClick={this.props.addTask.bind(null, this.state.text)}>
               Add
             </button>
           </div>
         );
       }
     });

     var TaskList = React.createClass({
       getInitialState: function() {
         return { tasks: this.props.tasks };
       },

       deleteTask: function(id) {
         var tasks = this.state.tasks;
         tasks.splice(id, 1);
         this.setState({ tasks: tasks });
       },

       addTask: function(text) {
         this.setState({ tasks: this.state.tasks.concat([{ text: text }]) });
       },

       render: function() {
         var self = this;
         var task_list = this.state.tasks.map(function(task, index) {
           return (
             <Task key={index}
                   text={task.text}
                   deleteTask={self.deleteTask.bind(self, task.id)} />
           );
         });
         return (
           <div className="task-list">
             <h1 className="list-title">
               {this.props.name}
             </h1>
             <ul className="list-tasks">
               {task_list}
             </ul>
             <AddTask addTask={self.addTask} />
           </div>
         );
       }
     });

     var App = React.createClass({
       render: function() {
         var lists = this.props.lists.map(function(list, index) {
           return (
             <TaskList key={index}
                       name={list.name}
                       tasks={list.tasks} />
           );
         });
         return (
           <div className="lists">
             {lists}
           </div>
         );
      }
     });

     var fixtures = {
       lists: [
         {
           name: "Todo",
           tasks: [
             {
               text: "Write example React app"
             },
             {
               text: "Write documentation"
             }
           ]
         },
         {
           name: "Done",
           tasks: [
             {
               text: "Learn the basics of React"
             }
           ]
         }
       ]
     };

     React.render(
       <App lists={fixtures.lists} />,
       document.body
     );
    </script>
  </body>
</html>
